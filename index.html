<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Chat Socket.IO</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  
</style>
</head>

<body>

<h2>Jeu</h2>

Votre nom : <input id="nom" type="text">
<button onclick="entrer()">Entrer</button>

<div id="chat" style="display:none;">
  <h3>Messages :</h3>
  <div id="messages"></div>

  <input id="msg" type="text" placeholder="Écrire un message...">
  <button onclick="envoyer()">Envoyer</button>
</div>
<div id="compteur" style="font-weight: bold; margin-bottom: 10px;">
</div>

<script>
  const socket = io();

  function entrer() {
    socket.emit('entrer', nom.value);
    document.getElementById('chat').style.display = 'block';
    //Kick le mec de trop
    socket.on('refus',msg=> {
      alert(msg);
    })
  }

  // Quand on est accepté
  socket.on('bienvenue', data => {
    ajouterMessage(` Bienvenue ${data.nom} !`);
  });

  // Quand un nouvel utilisateur arrive
  socket.on('nouveau', nom => {
    ajouterMessage(`${nom} a rejoint le chat`);
  });

  // Quand quelqu’un envoie un message
  socket.on('message', data => {
    ajouterMessage(`${data.auteur} : ${data.texte}`);
  });

  // Quand un utilisateur part
  socket.on('depart', nom => {
    ajouterMessage(`${nom} est parti`);
  });

  function envoyer() {
    socket.emit('message', msg.value);
    msg.value = "";
  }
  //Affiche le nombre d'utilisateur
 socket.on('NbUser', nb => {
    const compteur = document.getElementById("compteur");
    if (compteur) {
        compteur.textContent = "Joueurs connectés : " + nb;
    } else {
        console.error("Div #compteur introuvable !");
    }
});

  function ajouterMessage(txt) {
    const div = document.getElementById('messages');
    div.innerHTML += txt + "<br>";
    div.scrollTop = div.scrollHeight;
  }
</script>






<style>
  #chat {
  position: fixed;
  bottom: 100px;
  right: 20px;
  display: none;
  width: 300px;         
  height: 400px;
  background: rgba(255,255,255,0.92);
  box-shadow: 0 6px 18px rgba(0,0,0,0.15);
  border-radius: 8px;
  padding: 12px;
  box-sizing: border-box;
}

  body {
    font-family: Arial;
    max-width: 600px;
    margin: 30px auto;
    background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
    color: #222;
    min-height: 100vh;
  }

  #messages {
    border: 1px solid #aaa; padding: 10px; height: 300px; overflow-y: scroll; 
    }
</style>


</body>
</html>
